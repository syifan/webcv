<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EasyCV Vanilla Example</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet" href="./shared.css" />
  </head>
  <body>
        <div class="page">
      <div class="shell">
        <header class="hero">
          <span class="eyebrow">Vanilla HTML</span>
          <h1>EasyCV plain HTML</h1>
          <p class="lede">
            This page uses only CDN imports, a shared YAML file, and a few lines of JavaScript to
            render EasyCV without any framework or bundler.
          </p>
        </header>

        <main class="layout">
          <section class="callout">
            <div class="callout-header">
              <strong>How it works</strong>
              <p>
                EasyCV and <code>js-yaml</code> are imported from CDNs, the shared
                <code>cv_data.yml</code> is fetched, and <code>renderCv</code> mounts into
                <code>#cv-root</code>.
              </p>
            </div>
            <div class="steps">
              <div class="step">
                <span class="step-number">1</span>
                <p>Keep <code>cv_data.yml</code> in the shared <code>public/</code> folder.</p>
              </div>
              <div class="step">
                <span class="step-number">2</span>
                <p>Serve this folder locally (e.g. <code>python3 -m http.server 4173</code>).</p>
              </div>
              <div class="step">
                <span class="step-number">3</span>
                <p>Open the page; EasyCV renders automatically—no build tools required.</p>
              </div>
            </div>
          </section>

          <section class="cv-shell" aria-label="CV preview">
            <div id="cv-root" aria-live="polite" aria-busy="true">
              <p class="status">Loading <code>cv_data.yml</code>…</p>
            </div>
          </section>
        </main>
      </div>
    </div>

    <script type="module">
      import { renderCv } from "./easycv.mjs";
      import { load as loadYaml } from "./js-yaml.mjs";

      const host = document.getElementById("cv-root");
      const shadow = host.attachShadow({ mode: "open" });

      const shared = document.createElement("link");
      shared.rel = "stylesheet";
      shared.href = "./shared.css";

      const easycvCss = document.createElement("link");
      easycvCss.rel = "stylesheet";
      easycvCss.href = "./easycv.css";

      const mount = document.createElement("div");
      mount.id = "cv-mount";

      shadow.append(shared, easycvCss, mount);

      const setStatus = (message, isError = false) => {
        mount.innerHTML = `<p class="status${isError ? " error" : ""}">${message}</p>`;
      };

      const mountCv = async () => {
        setStatus("Loading cv_data.yml…");

        const response = await fetch("./cv_data.yml", { cache: "no-cache" });
        if (!response.ok) {
          throw new Error(`Failed to load cv_data.yml (status ${response.status})`);
        }

        const yamlText = await response.text();
        const data = loadYaml(yamlText);

        mount.innerHTML = "";
        renderCv(mount, data, {
          titleTemplate: "%s — EasyCV (Vanilla)",
          actions: true,
        });
      };

      mountCv().catch((error) => {
        console.error("Unable to render CV", error);
        setStatus("Unable to load cv_data.yml. Open the console for details.", true);
      });
    </script>
  </body>
</html>
